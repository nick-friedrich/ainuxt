# Internationalization (i18n) Layer

This document provides guidance on using the `layers/i18n` layer for internationalization in your Nuxt applications.

## Overview

The i18n layer implements internationalization using the `@nuxtjs/i18n` module (v9.5.3). It provides:

- Core i18n infrastructure and configuration
- Base locale setup for English and German
- Type definitions and typing support
- Integration with the Nuxt layer system

> **Important Update**: We are transitioning to a decentralized approach where each layer manages its own translations rather than centralizing them in the i18n layer. The i18n layer now primarily provides the infrastructure and configuration for internationalization.

## Important Development Note

For proper TypeScript typings when working with the i18n layer, you need to generate the `.nuxt` folder which contains the type definitions. This is especially important for layers with separate modules like nuxt-i18n.

Run the following command from the root of the monorepo:

```bash
# Generate types for the i18n layer
pnpm layer:dev --filter @layers/i18n
```

This command uses a special script in the i18n layer's package.json (`"layer:dev": "nuxt dev"`) that runs Nuxt in development mode, which generates the necessary type definitions.

## Usage

### 1. Extend the Layer

In your application's `nuxt.config.ts`, extend the i18n layer:

```typescript
// apps/your-app/nuxt.config.ts
export default defineNuxtConfig({
  extends: [
    // other layers
    "../../layers/i18n", // Path relative to your nuxt.config.ts
  ],
  // Other app-specific config
});
```

### 2. Creating Translations in Your Layer

Each layer should now manage its own translations. Here's how to implement this:

1. Create a locales directory in your layer structure:

```
layers/your-layer/
├── i18n/
│   └── locales/
│       ├── en/
│       │   └── your-layer.ts
│       └── de/
│           └── your-layer.ts
```

2. Define your translations:

```typescript
// layers/your-layer/i18n/locales/en/your-layer.ts
export const your_layer = {
  component_name: {
    title: "Title in English",
    description: "Description in English",
  },
  // More translations...
};
```

```typescript
// layers/your-layer/i18n/locales/de/your-layer.ts
export const your_layer = {
  component_name: {
    title: "Titel auf Deutsch",
    description: "Beschreibung auf Deutsch",
  },
  // More translations...
};
```

3. Create an entry point for each language:

```typescript
// layers/your-layer/i18n/locales/en.ts
import { your_layer } from "./en/your-layer";

export default {
  your_layer,
};

// Type exports for TypeScript support
type DeepPartial<T> = { [P in keyof T]?: DeepPartial<T[P]> };
export type tType = DeepPartial<typeof default>;
```

```typescript
// layers/your-layer/i18n/locales/de.ts
import { your_layer } from "./de/your-layer";

export default {
  your_layer,
};
```

4. Register your translations in your layer's `nuxt.config.ts`:

```typescript
// layers/your-layer/nuxt.config.ts
export default defineNuxtConfig({
  extends: ["../base"], // Make sure to extend the base layer
  i18n: {
    locales: [
      {
        code: "en",
        files: [
          "en.ts",
          "./i18n/locales/en.ts", // Path to your layer's english translations
        ],
      },
      {
        code: "de",
        files: [
          "de.ts",
          "./i18n/locales/de.ts", // Path to your layer's german translations
        ],
      },
    ],
  },
});
```

### 3. Using Translations in Components

```vue
<script setup lang="ts">
// Access translations with the useI18n composable
const { t, locale } = useI18n();

// For typed translations, you can import the type from your layer
import type { tType } from "../i18n/locales/en";
</script>

<template>
  <div>
    <!-- Use the t function to access translations -->
    <h1>{{ t("your_layer.component_name.title") }}</h1>
    <p>{{ t("your_layer.component_name.description") }}</p>
  </div>
</template>
```

## Best Practices

1. **Layer-Specific Namespaces**: Use your layer name as the top-level namespace (e.g., `auth.login.title`, `layout.header.menu`).

2. **Keep Translations Close to Components**: Store translations near the components that use them. This promotes modularity and easier maintenance.

3. **Type Safety**: Use the provided type definition for type-safe translations:

   ```typescript
   import type { tType } from "../i18n/locales/en";

   // Now you'll get type checking on translation keys
   const message: keyof tType["your_layer"]["component_name"] = "title";
   ```

4. **Missing Translations**: Always add translations to all language files. If a translation is temporarily missing, use the key in English as a fallback rather than leaving it blank.

5. **Variable Interpolation**: Use named variables for dynamic content:

   ```typescript
   // In translation file
   greet_user: "Hello, {name}!",
     // In component
     t("your_layer.component_name.greet_user", { name: user.name });
   ```

6. **Pluralization**: For quantity-based text, use pluralization:

   ```typescript
   // In translation file
   items_count: "No items | One item | {count} items",
     // In component
     t("your_layer.component_name.items_count", count);
   ```

## Adding a New Language

To add a new language:

1. Update the i18n configuration in `layers/i18n/nuxt.config.ts`
2. Create corresponding translation files in each layer for the new language

## Testing Translations

During development, you can test your translations by:

- Switching languages using the LanguageSwitcher component
- Adding `?locale=de` to the URL
- Using the `locale.value = 'de'` in component code
