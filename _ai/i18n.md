# Internationalization (i18n) Layer

This document provides guidance on using the `layers/i18n` layer for internationalization in your Nuxt applications.

## Overview

The i18n layer implements internationalization using the `@nuxtjs/i18n` module (v9.5.3). It provides:

- Pre-configured locale setup for English and German
- A structured translation architecture
- Type definitions for translations
- Organized locale files by feature/component

## Important Development Note

For proper TypeScript typings when working with the i18n layer, you need to generate the `.nuxt` folder which contains the type definitions. This is especially important for layers with separate modules like nuxt-i18n.

Run the following command from the root of the monorepo:

```bash
# Generate types for the i18n layer
pnpm layer:dev --filter @layers/i18n
```

This command uses a special script in the i18n layer's package.json (`"layer:dev": "nuxt dev"`) that runs Nuxt in development mode, which generates the necessary type definitions.

## Usage

### 1. Extend the Layer

In your application's `nuxt.config.ts`, extend the i18n layer:

```typescript
// apps/your-app/nuxt.config.ts
export default defineNuxtConfig({
  extends: [
    // other layers
    "../../layers/i18n", // Path relative to your nuxt.config.ts
  ],
  // Other app-specific config
});
```

### 2. Using Translations in Components

```vue
<script setup lang="ts">
// Access translations with the useI18n composable
const { t, locale } = useI18n();

// For typed translations, you can import the type
import type { tType } from "../../layers/i18n/i18n/locales/en";
</script>

<template>
  <div>
    <!-- Use the t function to access translations -->
    <h1>{{ t("page_index.title") }}</h1>
    <p>{{ t("common.welcome_message") }}</p>

    <!-- Access nested translations -->
    <div>{{ t("validation.required") }}</div>
  </div>
</template>
```

### 3. Adding New Translations

Translations are organized by feature/component. To add new translations:

1. Find the appropriate locale file in `layers/i18n/i18n/locales/{locale}/{feature}.ts`
2. Add your new translation key
3. Add the same key to all other locales to ensure consistency

Example:

```typescript
// layers/i18n/i18n/locales/en/common.ts
export const common = {
  welcome_message: "Welcome to our site",
  your_new_key: "Your new message here",
};
```

```typescript
// layers/i18n/i18n/locales/de/common.ts
export const common = {
  welcome_message: "Willkommen auf unserer Website",
  your_new_key: "Ihre neue Nachricht hier",
};
```

## Best Practices

1. **Use Namespaced Keys**: Always use namespaces like `page_index.title` or `common.welcome` for better organization and to avoid key conflicts.

2. **Keep Translations Organized**: Use separate files for:

   - UI components (`common.ts`, `layout.ts`)
   - Pages (`page_home.ts`, `page_contact.ts`)
   - Features (`validation.ts`, `auth.ts`)

3. **Type Safety**: Use the provided type definition for type-safe translations:

   ```typescript
   import type { tType } from "../../layers/i18n/i18n/locales/en";

   // Now you'll get type checking on translation keys
   const message: keyof tType["common"] = "welcome_message";
   ```

4. **Missing Translations**: Always add translations to all language files. If a translation is temporarily missing, use the key in English as a fallback rather than leaving it blank.

5. **Variable Interpolation**: Use named variables for dynamic content:

   ```typescript
   // In translation file
   greet_user: "Hello, {name}!",
     // In component
     t("common.greet_user", { name: user.name });
   ```

6. **Pluralization**: For quantity-based text, use pluralization:

   ```typescript
   // In translation file
   items_count: "No items | One item | {count} items",
     // In component
     t("common.items_count", count);
   ```

## Structure

The current layer structure:

```
layers/i18n/
├── i18n/
│   └── locales/
│       ├── en.ts            # English entry point
│       ├── en/              # English translations by feature
│       │   ├── common.ts
│       │   ├── layout.ts
│       │   ├── page_index.ts
│       │   └── ...
│       ├── de.ts            # German entry point
│       └── de/              # German translations by feature
│           ├── common.ts
│           ├── layout.ts
│           └── ...
├── nuxt.config.ts           # i18n module configuration
└── package.json             # Dependencies including @nuxtjs/i18n
```

## Adding a New Language

To add a new language:

1. Update the i18n configuration in `layers/i18n/nuxt.config.ts`
2. Create a new locale file (e.g., `fr.ts`) and corresponding directory
3. Add translations for all existing keys

Example:

```typescript
// Add to nuxt.config.ts in the locales array
{
  code: 'fr',
  iso: 'fr-FR',
  name: 'Français',
  file: 'fr.ts'
}
```

## Testing Translations

During development, you can test your translations by:

- Switching languages using the LanguageSwitcher component
- Adding `?locale=de` to the URL
- Using the `locale.value = 'de'` in component code
